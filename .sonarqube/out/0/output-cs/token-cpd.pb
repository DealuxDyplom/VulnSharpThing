¶;
[C:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Services\UserService.cs
	namespace 	
VulnerableApp
 
. 
Services  
{ 
public 

	interface 
IUserService !
{ 
Task		 
<		 
User		 
?		 
>		 
Authenticate		  
(		  !
string		! '
username		( 0
,		0 1
string		2 8
password		9 A
)		A B
;		B C
Task

 
<

 
List

 
<

 
User

 
>

 
>

 
SearchUsers

 $
(

$ %
string

% +
query

, 1
)

1 2
;

2 3
Task 
< 
User 
? 
> 
GetUserById 
(  
int  #
id$ &
)& '
;' (
Task 
< 
bool 
> 
RegisterUser 
(  
User  $
user% )
)) *
;* +
Task 
< 
List 
< 
User 
> 
> 
GetAllUsers $
($ %
)% &
;& '
} 
public 

class 
UserService 
: 
IUserService +
{ 
private 
readonly  
ApplicationDbContext -
_context. 6
;6 7
private 
readonly 
ILogger  
<  !
UserService! ,
>, -
_logger. 5
;5 6
public 
UserService 
(  
ApplicationDbContext /
context0 7
,7 8
ILogger9 @
<@ A
UserServiceA L
>L M
loggerN T
)T U
{ 	
_context 
= 
context 
; 
_logger 
= 
logger 
; 
} 	
public 
async 
Task 
< 
List 
< 
User #
># $
>$ %
SearchUsers& 1
(1 2
string2 8
query9 >
)> ?
{ 	
try 
{   
var"" 
allUsers"" 
="" 
await"" $
_context""% -
.""- .
Users"". 3
.""3 4
ToListAsync""4 ?
(""? @
)""@ A
;""A B
var%% 
filteredUsers%% !
=%%" #
allUsers%%$ ,
.%%, -
Where%%- 2
(%%2 3
u%%3 4
=>%%5 7
u&& 
.&& 
Username&& 
.&& 
Contains&& '
(&&' (
query&&( -
,&&- .
StringComparison&&/ ?
.&&? @
OrdinalIgnoreCase&&@ Q
)&&Q R
||&&S U
u'' 
.'' 
Email'' 
.'' 
Contains'' $
(''$ %
query''% *
,''* +
StringComparison'', <
.''< =
OrdinalIgnoreCase''= N
)''N O
)''O P
.''P Q
ToList''Q W
(''W X
)''X Y
;''Y Z
_logger** 
.** 

LogWarning** "
(**" #
$"**# %
$str**% b
{**b c
query**c h
}**h i
$str**i |
{**| }
query	**} Ç
}
**Ç É
$str
**É Ö
"
**Ö Ü
)
**Ü á
;
**á à
return,, 
filteredUsers,, $
;,,$ %
}-- 
catch.. 
(.. 
	Exception.. 
ex.. 
)..  
{// 
_logger00 
.00 
LogError00  
(00  !
ex00! #
,00# $
$str00% ;
)00; <
;00< =
return11 
new11 
List11 
<11  
User11  $
>11$ %
(11% &
)11& '
;11' (
}22 
}33 	
public66 
async66 
Task66 
<66 
List66 
<66 
User66 #
>66# $
>66$ %!
SearchUsersVulnerable66& ;
(66; <
string66< B
query66C H
)66H I
{77 	
return>> 
await>> 
SearchUsers>> $
(>>$ %
query>>% *
)>>* +
;>>+ ,
}?? 	
publicBB 
asyncBB 
TaskBB 
<BB 
UserBB 
?BB 
>BB  
AuthenticateBB! -
(BB- .
stringBB. 4
usernameBB5 =
,BB= >
stringBB? E
passwordBBF N
)BBN O
{CC 	
varEE 
userEE 
=EE 
awaitEE 
_contextEE %
.EE% &
UsersEE& +
.FF 
FirstOrDefaultAsyncFF $
(FF$ %
uFF% &
=>FF' )
uFF* +
.FF+ ,
UsernameFF, 4
==FF5 7
usernameFF8 @
&&FFA C
uFFD E
.FFE F
PasswordFFF N
==FFO Q
passwordFFR Z
)FFZ [
;FF[ \
ifHH 
(HH 
userHH 
!=HH 
nullHH 
)HH 
{II 
_loggerKK 
.KK 
LogInformationKK &
(KK& '
$"KK' )
$strKK) .
{KK. /
usernameKK/ 7
}KK7 8
$strKK8 R
{KKR S
passwordKKS [
}KK[ \
"KK\ ]
)KK] ^
;KK^ _
}LL 
returnNN 
userNN 
;NN 
}OO 	
publicRR 
asyncRR 
TaskRR 
<RR 
UserRR 
?RR 
>RR  
GetUserByIdRR! ,
(RR, -
intRR- 0
idRR1 3
)RR3 4
{SS 	
returnUU 
awaitUU 
_contextUU !
.UU! "
UsersUU" '
.UU' (
	FindAsyncUU( 1
(UU1 2
idUU2 4
)UU4 5
;UU5 6
}VV 	
publicXX 
asyncXX 
TaskXX 
<XX 
ListXX 
<XX 
UserXX #
>XX# $
>XX$ %
GetAllUsersXX& 1
(XX1 2
)XX2 3
{YY 	
return[[ 
await[[ 
_context[[ !
.[[! "
Users[[" '
.[[' (
ToListAsync[[( 3
([[3 4
)[[4 5
;[[5 6
}\\ 	
public__ 
async__ 
Task__ 
<__ 
bool__ 
>__ 
RegisterUser__  ,
(__, -
User__- 1
user__2 6
)__6 7
{`` 	
tryaa 
{bb 
_contextdd 
.dd 
Usersdd 
.dd 
Adddd "
(dd" #
userdd# '
)dd' (
;dd( )
awaitee 
_contextee 
.ee 
SaveChangesAsyncee /
(ee/ 0
)ee0 1
;ee1 2
returnff 
trueff 
;ff 
}gg 
catchhh 
(hh 
	Exceptionhh 
exhh 
)hh  
{ii 
_loggerjj 
.jj 
LogErrorjj  
(jj  !
exjj! #
,jj# $
$strjj% =
)jj= >
;jj> ?
returnkk 
falsekk 
;kk 
}ll 
}mm 	
}nn 
}oo ∂ 
[C:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Services\FileService.cs
	namespace 	
VulnerableApp
 
. 
Services  
{ 
public 

	interface 
IFileService !
{ 
Task 
< 
string 
> 
ReadFile 
( 
string $
filePath% -
)- .
;. /
Task 
< 
bool 
> 

UploadFile 
( 
	IFormFile '
file( ,
,, -
string. 4

uploadPath5 ?
)? @
;@ A
Task 
< 
bool 
> 

DeleteFile 
( 
string $
filePath% -
)- .
;. /
} 
public

 

class

 
FileService

 
:

 
IFileService

 +
{ 
private 
readonly 
ILogger  
<  !
FileService! ,
>, -
_logger. 5
;5 6
public 
FileService 
( 
ILogger "
<" #
FileService# .
>. /
logger0 6
)6 7
{ 	
_logger 
= 
logger 
; 
} 	
public 
async 
Task 
< 
string  
>  !
ReadFile" *
(* +
string+ 1
filePath2 :
): ;
{ 	
_logger 
. 
LogInformation "
(" #
$"# %
$str% 3
{3 4
filePath4 <
}< =
"= >
)> ?
;? @
return 
await 
File 
. 
ReadAllTextAsync .
(. /
filePath/ 7
)7 8
;8 9
} 	
public 
async 
Task 
< 
bool 
> 

UploadFile  *
(* +
	IFormFile+ 4
file5 9
,9 :
string; A

uploadPathB L
)L M
{ 	
var 
fullPath 
= 
Path 
.  
Combine  '
(' (

uploadPath( 2
,2 3
file4 8
.8 9
FileName9 A
)A B
;B C
using"" 
("" 
var"" 
stream"" 
="" 
new""  #

FileStream""$ .
("". /
fullPath""/ 7
,""7 8
FileMode""9 A
.""A B
Create""B H
)""H I
)""I J
{## 
await$$ 
file$$ 
.$$ 
CopyToAsync$$ &
($$& '
stream$$' -
)$$- .
;$$. /
}%% 
_logger'' 
.'' 
LogInformation'' "
(''" #
$"''# %
$str''% 4
{''4 5
fullPath''5 =
}''= >
"''> ?
)''? @
;''@ A
return(( 
true(( 
;(( 
})) 	
public,, 
async,, 
Task,, 
<,, 
bool,, 
>,, 

DeleteFile,,  *
(,,* +
string,,+ 1
filePath,,2 :
),,: ;
{-- 	
if// 
(// 
File// 
.// 
Exists// 
(// 
filePath// $
)//$ %
)//% &
{00 
File11 
.11 
Delete11 
(11 
filePath11 $
)11$ %
;11% &
_logger22 
.22 
LogInformation22 &
(22& '
$"22' )
$str22) 7
{227 8
filePath228 @
}22@ A
"22A B
)22B C
;22C D
return33 
true33 
;33 
}44 
return55 
false55 
;55 
}66 	
}77 
}88 ˘
NC:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Program.cs
var 
builder 
= 
WebApplication 
. 
CreateBuilder *
(* +
args+ /
)/ 0
;0 1
builder 
. 
Services 
. #
AddControllersWithViews (
(( )
)) *
;* +
builder 
. 
Services 
. 
AddDbContext 
<  
ApplicationDbContext 2
>2 3
(3 4
options4 ;
=>< >
options 
. 
UseInMemoryDatabase 
(  
$str  1
)1 2
)2 3
;3 4
builder 
. 
Services 
. 
	AddScoped 
< 
IUserService '
,' (
UserService) 4
>4 5
(5 6
)6 7
;7 8
builder 
. 
Services 
. 
AddSingleton 
< 
IFileService *
,* +
FileService, 7
>7 8
(8 9
)9 :
;: ;
builder 
. 
Services 
. "
AddHttpContextAccessor '
(' (
)( )
;) *
builder 
. 
Services 
. 

AddSession 
( 
) 
; 
var 
app 
= 	
builder
 
. 
Build 
( 
) 
; 
app 
. %
UseDeveloperExceptionPage 
( 
) 
;  
app 
. 
UseStaticFiles 
( 
) 
; 
app 
. 

UseRouting 
( 
) 
; 
app 
. 

UseSession 
( 
) 
; 
app 
. 
UseAuthorization 
( 
) 
; 
app 
. 
MapControllerRoute 
( 
name 
: 	
$str
 
, 
pattern 
: 
$str 5
)5 6
;6 7
using"" 
("" 
var"" 

scope"" 
="" 
app"" 
."" 
Services"" 
.""  
CreateScope""  +
(""+ ,
)"", -
)""- .
{## 
var$$ 
context$$ 
=$$ 
scope$$ 
.$$ 
ServiceProvider$$ '
.$$' (
GetRequiredService$$( :
<$$: ; 
ApplicationDbContext$$; O
>$$O P
($$P Q
)$$Q R
;$$R S
context%% 
.%% 
Database%% 
.%% 
EnsureCreated%% "
(%%" #
)%%# $
;%%$ %
}&& 
app(( 
.(( 
Run(( 
((( 
)(( 	
;((	 
Ò
[C:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Pages\Privacy.cshtml.cs
	namespace 	
VulnerableApp
 
. 
Pages 
{ 
public 

class 
PrivacyModel 
: 
	PageModel  )
{ 
private 
readonly 
ILogger  
<  !
PrivacyModel! -
>- .
_logger/ 6
;6 7
public

 
PrivacyModel

 
(

 
ILogger

 #
<

# $
PrivacyModel

$ 0
>

0 1
logger

2 8
)

8 9
{ 	
_logger 
= 
logger 
; 
} 	
public 
void 
OnGet 
( 
) 
{ 	
} 	
} 
} Á
YC:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Pages\Index.cshtml.cs
	namespace 	
VulnerableApp
 
. 
Pages 
{ 
public 

class 

IndexModel 
: 
	PageModel '
{ 
private 
readonly 
ILogger  
<  !

IndexModel! +
>+ ,
_logger- 4
;4 5
public

 

IndexModel

 
(

 
ILogger

 !
<

! "

IndexModel

" ,
>

, -
logger

. 4
)

4 5
{ 	
_logger 
= 
logger 
; 
} 	
public 
void 
OnGet 
( 
) 
{ 	
} 	
} 
} ‚
XC:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Pages\Home.cshtml.cs
	namespace 	
VulnerableApp
 
. 
Pages 
{ 
public 

class 
	HomeModel 
: 
	PageModel &
{ 
private 
readonly 
ILogger  
<  !
	HomeModel! *
>* +
_logger, 3
;3 4
public

 
	HomeModel

 
(

 
ILogger

  
<

  !
	HomeModel

! *
>

* +
logger

, 2
)

2 3
{ 	
_logger 
= 
logger 
; 
} 	
public 
void 
OnGet 
( 
) 
{ 	
} 	
} 
} Ù
YC:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Pages\Error.cshtml.cs
	namespace 	
VulnerableApp
 
. 
Pages 
{ 
[ 
ResponseCache 
( 
Duration 
= 
$num 
,  
Location! )
=* +!
ResponseCacheLocation, A
.A B
NoneB F
,F G
NoStoreH O
=P Q
trueR V
)V W
]W X
[ "
IgnoreAntiforgeryToken 
] 
public		 

class		 

ErrorModel		 
:		 
	PageModel		 '
{

 
public 
string 
? 
	RequestId  
{! "
get# &
;& '
set( +
;+ ,
}- .
public 
bool 
ShowRequestId !
=>" $
!% &
string& ,
., -
IsNullOrEmpty- :
(: ;
	RequestId; D
)D E
;E F
private 
readonly 
ILogger  
<  !

ErrorModel! +
>+ ,
_logger- 4
;4 5
public 

ErrorModel 
( 
ILogger !
<! "

ErrorModel" ,
>, -
logger. 4
)4 5
{ 	
_logger 
= 
logger 
; 
} 	
public 
void 
OnGet 
( 
) 
{ 	
	RequestId 
= 
Activity  
.  !
Current! (
?( )
.) *
Id* ,
??- /
HttpContext0 ;
.; <
TraceIdentifier< K
;K L
} 	
} 
} ø
RC:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Models\User.cs
	namespace 	
VulnerableApp
 
. 
Models 
{ 
public 

class 
User 
{ 
public 
int 
Id 
{ 
get 
; 
set  
;  !
}" #
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Email 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
public		 
string		 
Role		 
{		 
get		  
;		  !
set		" %
;		% &
}		' (
=		) *
$str		+ 1
;		1 2
public

 
string

 
?

 

CreditCard

 !
{

" #
get

$ '
;

' (
set

) ,
;

, -
}

. /
public 
DateTime 
	CreatedAt !
{" #
get$ '
;' (
set) ,
;, -
}. /
=0 1
DateTime2 :
.: ;
Now; >
;> ?
} 
public 

class 

LoginModel 
{ 
public 
string 
Username 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Password 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
bool 

RememberMe 
{  
get! $
;$ %
set& )
;) *
}+ ,
} 
public 

class 
SearchModel 
{ 
public 
string 
Query 
{ 
get !
;! "
set# &
;& '
}( )
=* +
string, 2
.2 3
Empty3 8
;8 9
} 
public 

class 
	FileModel 
{ 
public 
string 
FileName 
{  
get! $
;$ %
set& )
;) *
}+ ,
=- .
string/ 5
.5 6
Empty6 ;
;; <
public 
string 
Content 
{ 
get  #
;# $
set% (
;( )
}* +
=, -
string. 4
.4 5
Empty5 :
;: ;
} 
} ®
`C:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Data\ApplicationDbContext.cs
	namespace 	
VulnerableApp
 
. 
Data 
{ 
public 

class  
ApplicationDbContext %
:& '
	DbContext( 1
{ 
public  
ApplicationDbContext #
(# $
DbContextOptions$ 4
<4 5 
ApplicationDbContext5 I
>I J
optionsK R
)R S
:		 
base		 
(		 
options		 
)		 
{

 	
} 	
public 
DbSet 
< 
User 
> 
Users  
{! "
get# &
;& '
set( +
;+ ,
}- .
	protected 
override 
void 
OnModelCreating  /
(/ 0
ModelBuilder0 <
modelBuilder= I
)I J
{ 	
modelBuilder 
. 
Entity 
<  
User  $
>$ %
(% &
)& '
.' (
HasData( /
(/ 0
new 
User 
{ 
Id 
= 
$num 
, 
Username 
= 
$str &
,& '
Password 
= 
$str )
,) *
Email 
= 
$str ,
,, -
Role 
= 
$str "
," #

CreditCard 
=  
$str! 6
} 
, 
new 
User 
{ 
Id 
= 
$num 
, 
Username 
= 
$str %
,% &
Password   
=   
$str   )
,  ) *
Email!! 
=!! 
$str!! +
,!!+ ,
Role"" 
="" 
$str"" !
,""! "

CreditCard## 
=##  
$str##! 6
}$$ 
)%% 
;%% 
}&& 	
}'' 
}(( óI
aC:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Controllers\HomeController.cs
	namespace 	
VulnerableApp
 
. 
Controllers #
{ 
public 

class 
HomeController 
:  !

Controller" ,
{		 
private

 
readonly

 
IUserService

 %
_userService

& 2
;

2 3
private 
readonly 
IFileService %
_fileService& 2
;2 3
private 
readonly 
ILogger  
<  !
HomeController! /
>/ 0
_logger1 8
;8 9
public 
HomeController 
( 
IUserService *
userService+ 6
,6 7
IFileService8 D
fileServiceE P
,P Q
ILoggerR Y
<Y Z
HomeControllerZ h
>h i
loggerj p
)p q
{ 	
_userService 
= 
userService &
;& '
_fileService 
= 
fileService &
;& '
_logger 
= 
logger 
; 
} 	
public 
IActionResult 
Index "
(" #
)# $
{ 	
ViewBag 
. 
SearchQuery 
=  !
HttpContext" -
.- .
Request. 5
.5 6
Query6 ;
[; <
$str< D
]D E
;E F
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Search) /
(/ 0
SearchModel0 ;
model< A
)A B
{   	
if!! 
(!! 
!!! 
string!! 
.!! 
IsNullOrEmpty!! %
(!!% &
model!!& +
.!!+ ,
Query!!, 1
)!!1 2
)!!2 3
{"" 
var## 
results## 
=## 
await## #
_userService##$ 0
.##0 1
SearchUsers##1 <
(##< =
model##= B
.##B C
Query##C H
)##H I
;##I J
return$$ 
View$$ 
($$ 
$str$$ +
,$$+ ,
results$$- 4
)$$4 5
;$$5 6
}%% 
return&& 
RedirectToAction&& #
(&&# $
$str&&$ +
)&&+ ,
;&&, -
}'' 	
[** 	
HttpGet**	 
]** 
public++ 
async++ 
Task++ 
<++ 
IActionResult++ '
>++' (
ViewFile++) 1
(++1 2
string++2 8
fileName++9 A
)++A B
{,, 	
if-- 
(-- 
string-- 
.-- 
IsNullOrEmpty-- $
(--$ %
fileName--% -
)--- .
)--. /
return.. 

BadRequest.. !
(..! "
).." #
;..# $
var11 
basePath11 
=11 
	Directory11 $
.11$ %
GetCurrentDirectory11% 8
(118 9
)119 :
;11: ;
var22 
filePath22 
=22 
Path22 
.22  
Combine22  '
(22' (
basePath22( 0
,220 1
$str222 ;
,22; <
fileName22= E
)22E F
;22F G
try44 
{55 
var66 
content66 
=66 
await66 #
_fileService66$ 0
.660 1
ReadFile661 9
(669 :
filePath66: B
)66B C
;66C D
ViewBag77 
.77 
FileContent77 #
=77$ %
content77& -
;77- .
return88 
View88 
(88 
)88 
;88 
}99 
catch:: 
(:: 
	Exception:: 
ex:: 
)::  
{;; 
ViewBag<< 
.<< 
Error<< 
=<< 
ex<<  "
.<<" #
Message<<# *
;<<* +
return== 
View== 
(== 
)== 
;== 
}>> 
}?? 	
[BB 	
HttpPostBB	 
]BB 
publicCC 
asyncCC 
TaskCC 
<CC 
IActionResultCC '
>CC' (

UploadFileCC) 3
(CC3 4
	IFormFileCC4 =
fileCC> B
)CCB C
{DD 	
ifEE 
(EE 
fileEE 
!=EE 
nullEE 
&&EE 
fileEE  $
.EE$ %
LengthEE% +
>EE, -
$numEE. /
)EE/ 0
{FF 
varGG 

uploadPathGG 
=GG  
PathGG! %
.GG% &
CombineGG& -
(GG- .
	DirectoryGG. 7
.GG7 8
GetCurrentDirectoryGG8 K
(GGK L
)GGL M
,GGM N
$strGGO X
)GGX Y
;GGY Z
	DirectoryII 
.II 
CreateDirectoryII )
(II) *

uploadPathII* 4
)II4 5
;II5 6
awaitJJ 
_fileServiceJJ "
.JJ" #

UploadFileJJ# -
(JJ- .
fileJJ. 2
,JJ2 3

uploadPathJJ4 >
)JJ> ?
;JJ? @
ViewBagKK 
.KK 
MessageKK 
=KK  !
$strKK" ?
;KK? @
}LL 
returnMM 
ViewMM 
(MM 
$strMM 
)MM  
;MM  !
}NN 	
[QQ 	
HttpPostQQ	 
]QQ 
publicRR 
IActionResultRR 
ProcessDataRR (
(RR( )
stringRR) /
jsonDataRR0 8
)RR8 9
{SS 	
tryTT 
{UU 
varWW 
optionsWW 
=WW 
newWW !!
JsonSerializerOptionsWW" 7
{XX '
PropertyNameCaseInsensitiveYY /
=YY0 1
trueYY2 6
,YY6 7
}ZZ 
;ZZ 
var\\ 
data\\ 
=\\ 
JsonSerializer\\ )
.\\) *
Deserialize\\* 5
<\\5 6
object\\6 <
>\\< =
(\\= >
jsonData\\> F
,\\F G
options\\H O
)\\O P
;\\P Q
return]] 
Json]] 
(]] 
new]] 
{]]  !
success]]" )
=]]* +
true]], 0
,]]0 1
data]]2 6
=]]7 8
data]]9 =
}]]> ?
)]]? @
;]]@ A
}^^ 
catch__ 
(__ 
	Exception__ 
ex__ 
)__  
{`` 
returnaa 
Jsonaa 
(aa 
newaa 
{aa  !
successaa" )
=aa* +
falseaa, 1
,aa1 2
erroraa3 8
=aa9 :
exaa; =
.aa= >
Messageaa> E
}aaF G
)aaG H
;aaH I
}bb 
}cc 	
[ff 	
HttpGetff	 
]ff 
publicgg 
asyncgg 
Taskgg 
<gg 
IActionResultgg '
>gg' (
UserProfilegg) 4
(gg4 5
intgg5 8
userIdgg9 ?
)gg? @
{hh 	
varjj 
userjj 
=jj 
awaitjj 
_userServicejj )
.jj) *
GetUserByIdjj* 5
(jj5 6
userIdjj6 <
)jj< =
;jj= >
ifkk 
(kk 
userkk 
==kk 
nullkk 
)kk 
returnll 
NotFoundll 
(ll  
)ll  !
;ll! "
returnnn 
Viewnn 
(nn 
usernn 
)nn 
;nn 
}oo 	
[rr 	
HttpPostrr	 
]rr 
publicss 
asyncss 
Taskss 
<ss 
IActionResultss '
>ss' (
UpdateProfiless) 6
(ss6 7
Userss7 ;
userss< @
)ss@ A
{tt 	
awaitvv 
_userServicevv 
.vv 
RegisterUservv +
(vv+ ,
uservv, 0
)vv0 1
;vv1 2
returnww 
RedirectToActionww #
(ww# $
$strww$ +
)ww+ ,
;ww, -
}xx 	
publiczz 
IActionResultzz 
Privacyzz $
(zz$ %
)zz% &
{{{ 	
return|| 
View|| 
(|| 
)|| 
;|| 
}}} 	
[ 	
ResponseCache	 
( 
Duration 
=  !
$num" #
,# $
Location% -
=. /!
ResponseCacheLocation0 E
.E F
NoneF J
,J K
NoStoreL S
=T U
trueV Z
)Z [
][ \
public
ÄÄ 
IActionResult
ÄÄ 
Error
ÄÄ "
(
ÄÄ" #
)
ÄÄ# $
{
ÅÅ 	
return
ÉÉ 
View
ÉÉ 
(
ÉÉ 
)
ÉÉ 
;
ÉÉ 
}
ÑÑ 	
}
ÖÖ 
}ÜÜ Ñ/
aC:\Users\–ù–∏–∫–æ–ª–∞–π\Desktop\—Ä–∞–±–æ—Ç–∞\–¢–ú–ö\SAST\VulnCheck2\Controllers\AuthController.cs
	namespace 	
VulnerableApp
 
. 
Controllers #
{ 
public 

class 
AuthController 
:  !

Controller" ,
{ 
private		 
readonly		 
IUserService		 %
_userService		& 2
;		2 3
public 
AuthController 
( 
IUserService *
userService+ 6
)6 7
{ 	
_userService 
= 
userService &
;& '
} 	
public 
IActionResult 
Login "
(" #
)# $
{ 	
return 
View 
( 
) 
; 
} 	
[ 	
HttpPost	 
] 
public 
async 
Task 
< 
IActionResult '
>' (
Login) .
(. /

LoginModel/ 9
model: ?
)? @
{ 	
if 
( 

ModelState 
. 
IsValid "
)" #
{ 
var 
user 
= 
await  
_userService! -
.- .
Authenticate. :
(: ;
model; @
.@ A
UsernameA I
,I J
modelK P
.P Q
PasswordQ Y
)Y Z
;Z [
if 
( 
user 
!= 
null  
)  !
{ 
HttpContext 
.  
Session  '
.' (
	SetString( 1
(1 2
$str2 <
,< =
user> B
.B C
UsernameC K
)K L
;L M
HttpContext   
.    
Session    '
.  ' (
	SetString  ( 1
(  1 2
$str  2 :
,  : ;
user  < @
.  @ A
Id  A C
.  C D
ToString  D L
(  L M
)  M N
)  N O
;  O P
HttpContext!! 
.!!  
Session!!  '
.!!' (
	SetString!!( 1
(!!1 2
$str!!2 8
,!!8 9
user!!: >
.!!> ?
Role!!? C
)!!C D
;!!D E
var$$ 
cookieOptions$$ %
=$$& '
new$$( +
CookieOptions$$, 9
{%% 
Expires&& 
=&&  !
model&&" '
.&&' (

RememberMe&&( 2
?&&3 4
DateTime&&5 =
.&&= >
Now&&> A
.&&A B
AddYears&&B J
(&&J K
$num&&K L
)&&L M
:&&N O
DateTime&&P X
.&&X Y
Now&&Y \
.&&\ ]
AddHours&&] e
(&&e f
$num&&f g
)&&g h
,&&h i
HttpOnly''  
=''! "
false''# (
,''( )
Secure(( 
=((  
false((! &
,((& '
SameSite))  
=))! "
SameSiteMode))# /
.))/ 0
None))0 4
}** 
;** 
Response,, 
.,, 
Cookies,, $
.,,$ %
Append,,% +
(,,+ ,
$str,,, 7
,,,7 8
user,,9 =
.,,= >
Id,,> @
.,,@ A
ToString,,A I
(,,I J
),,J K
,,,K L
cookieOptions,,M Z
),,Z [
;,,[ \
return.. 
RedirectToAction.. +
(..+ ,
$str.., 3
,..3 4
$str..5 ;
)..; <
;..< =
}// 

ModelState11 
.11 
AddModelError11 (
(11( )
$str11) +
,11+ ,
$str11- K
)11K L
;11L M
}22 
return44 
View44 
(44 
model44 
)44 
;44 
}55 	
public77 
IActionResult77 
Logout77 #
(77# $
)77$ %
{88 	
HttpContext:: 
.:: 
Session:: 
.::  
Clear::  %
(::% &
)::& '
;::' (
Response;; 
.;; 
Cookies;; 
.;; 
Delete;; #
(;;# $
$str;;$ /
);;/ 0
;;;0 1
return<< 
RedirectToAction<< #
(<<# $
$str<<$ +
,<<+ ,
$str<<- 3
)<<3 4
;<<4 5
}== 	
public?? 
IActionResult?? 
ResetPassword?? *
(??* +
)??+ ,
{@@ 	
returnAA 
ViewAA 
(AA 
)AA 
;AA 
}BB 	
[EE 	
HttpPostEE	 
]EE 
publicFF 
IActionResultFF 
ResetPasswordFF *
(FF* +
stringFF+ 1
emailFF2 7
)FF7 8
{GG 	
varII 
existsII 
=II 
trueII 
;II 
ifKK 
(KK 
existsKK 
)KK 
{LL 
varNN 

resetTokenNN 
=NN  
GuidNN! %
.NN% &
NewGuidNN& -
(NN- .
)NN. /
.NN/ 0
ToStringNN0 8
(NN8 9
)NN9 :
.NN: ;
	SubstringNN; D
(NND E
$numNNE F
,NNF G
$numNNH I
)NNI J
;NNJ K
ViewBagOO 
.OO 
MessageOO 
=OO  !
$"OO" $
$strOO$ 6
{OO6 7

resetTokenOO7 A
}OOA B
"OOB C
;OOC D
}PP 
elseQQ 
{RR 
ViewBagSS 
.SS 
MessageSS 
=SS  !
$strSS" T
;SST U
}TT 
returnVV 
ViewVV 
(VV 
)VV 
;VV 
}WW 	
}XX 
}YY 